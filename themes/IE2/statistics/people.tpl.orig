<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>統計報表</title>
    <link type="text/css" href="{$tpl_path}/css/font_style.css" rel="stylesheet" />
    <link type="text/css" href="{$tpl_path}/css/layout.css" rel="stylesheet" />
    <link type="text/css" href="{$tpl_path}/css/statistics/people.css" rel="stylesheet" />
    <link type="text/css" href="../css/smoothness/jquery-ui-1.7.2.custom.css" rel="stylesheet" />
    <script type="text/javascript" src="../script/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="../script/jquery-ui-1.7.2.custom.min.js"></script>
{literal}
    <script type="text/javascript">
        $(function(){
            $('#date_begin').datepicker({ dateFormat: 'yy-mm-dd' });
            $('#date_end').datepicker({ dateFormat: 'yy-mm-dd' });
            $('#date_enable').click(function(){$('#date_div').toggle(200)});
            $('#type_enable').click(function(){$('#type_div').toggle(200)});
            $('#name_enable').click(function(){$('#name_div').toggle(200)});
            $('#kind_enable').click(function(){$('#kind_div').toggle(200)});
            $('#type').change(function(){
                var type = $('#type').val();
                if (type != '0') {
                    $('#type_detail_div').hide(200);
                    $('#type_doc_div').hide(200);
                } else {
                    $('#type_detail_div').show(200);
                    $('#type_doc_div').show(200);
                }
                if (type != '1' && type != '2') {
                    $('#type_title_div').hide(200);
                } else {
                    $('#type_title_div').show(200);
                }
            });
            $('#class').change(function(){
                var class_ = $('#class').val();
                if(class_ != '1'){
                    $('#class_kind_div').hide();
                }else{
                    $('#class_kind_div').show(200);
                }
                if(class_ != '2'){
                    $('#class_for_div').hide();
                }else{
                    $('#class_for_div').show(200);
                }
            });
            check_DOC = function() {
                var type = $('#type').val();
                var type_location = $('#type_location').val();
                if (type != '0' || type_location == '-1')
                    return;
                $.getJSON(
                    'doc_fetch.php',
                    {
                        type_location: type_location
                    },
                    function(ret) {
                        var text = '<option value="-1">任意</option>'
                        for (var i = 0; i < ret.length; ++i)
                            text += '<option value="' + ret[i][0] + '">' + ret[i][1] + '</option>';
                        $('#type_doc').html(text);
                    }
                );
            };
            check_CLASS_KIND = function() {
                var class_kind = $('#class_kind').val();
                var _class = $('#class').val();
                if(_class != 1)
                {
                    class_kind = -1;
                }
                $.getJSON(
                    'course_fetch.php',
                    {
                        class_kind: class_kind
                    },
                    function(ret){
                        var text = '<option value="-1">任意</option>'
                        for (var i = 0; i < ret.length; ++i)
                        text += '<option value="' + ret[i][0] + '">' + ret[i][1] + '</option>';
                        $('#class_choose').html(text);
                    }
                );
            };
            check_CLASS_FOR =  function() {
                var class_for = $('#class_for').val();
                var _class = $('#class').val();
                if(_class != 2)
                {
                    class_for = -1;
                }
                $.getJSON(
                        'course_fetch.php',
                        {
                            class_for: class_for
                        },
                        function(ret){
                            var text = '<option value="-1">任意</option>'
                            for (var i = 0; i < ret.length; ++i)
                            text += '<option value="' + ret[i][0] + '">' + ret[i][1] + '</option>';
                            $('#class_choose').html(text);
                        }
                );
            };
            $('#type').change(check_DOC);
            $('#type_location').change(check_DOC);
            $('#class_kind').change(check_CLASS_KIND);
            $('#class_for').change(check_CLASS_FOR);
            $('#class').change(check_CLASS_KIND);
        })
    </script>
{/literal}
    <script type="text/javascript">
{literal}
        $(function(){
            var type = $('#type').val();
            /*check_CLASS_FOR();*/
            if (type != '0') {
                $('#type_detail_div').hide();
                $('#type_doc_div').hide();
            }
            if (type != '1' && type != '2') {
                $('#type_title_div').hide();
            }
            var class_ = $('#class').val();
            if  (class_ != '1'){
                $('#class_kind_div').hide();
            }
            if  (class_ != '2'){
                $('#class_for_div').hide();
            }
{/literal}
{if !isset($date_enable)}$('#date_div').toggle();{/if}
{if !isset($kind_enable)}$('#kind_div').toggle();{/if}
{if !isset($type_enable)}$('#type_div').toggle();{/if}
{if !isset($name_enable)}$('#name_div').toggle();{/if}
{literal}
        })
{/literal}
    </script>
</head>

<body>
    <form id="query" action="people.php" method="post">
        <h1>查詢條件</h1>
        <div id="cond">
        <div id="classes">
            <h2>課程</h2>
            <p>
                選擇課程:
                <select name="class" id="class">
                    <option value="-1"{if $class eq '-1'} selected="selected"{/if}>任意</option>
                    <option value="1"{if $class eq '1'} selected="selected"{/if}>依課程性質</option>
                    <option value="2"{if $class eq '2'} selected="selected"{/if}>依開課對象</option>
                </select>
            </p>
            <div id="class_kind_div">
                <p>
                    課程性質:
                    <select name= "class_kind" id="class_kind">
{foreach from=$course_property key=id item=name}
                        <option value="{$id|escape}"{if $class_kind eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                    </select>
                </p>
            </div>
            <div id="class_for_div">
                <p>
                    開課對象:
                    <select name="class_for" id="class_for">
                        <option value="-1"{if $class_for eq '-1'} selected="selected"{/if}>任意</option>
                        <option value="1"{if $class_for eq '0'} selected="selected"{/if}>一般民眾</option>
                        <option value="2"{if $class_for eq '1'} selected="selected"{/if}>國民中小學教師</option>
                        <option value="3"{if $class_for eq '2'} selected="selected"{/if}>高中職教師</option>
                        <option value="4"{if $class_for eq '3'} selected="selected"{/if}>大專院校師生</option>
                    </select>
                </p>
            </div>
            <div id="class_choose_div">
                <p>
                    <select name="class_choose" id="class_choose">
{foreach from=$class_list key=id item=name}
                        <option value="{$id|escape}"{if $class_choose eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                    </select>
                </p>
            </div>
        </div>
        <div id="people">
            <h2>人員</h2>
            <p>
                <input id="date_enable" name="date_enable"type="checkbox" {if isset($date_enable)}checked="checked" {/if}/>
                <label>修課日期</label>
                <div id="date_div">
                <label>在此日之後:</label>
                <input id="date_begin" name="date_begin" value="{$date_begin|escape}" />
                <label>在此日之前:</label>
                <input id="date_end" name="date_end" value="{$date_end|escape}" />
                </div>
            </p>
            <p>
                <input id="type_enable" name="type_enable" type="checkbox" {if isset($type_enable)}checked="checked" {/if}/>
                <label>身分:</label>
                <div id="type_div">
                    <select id="type" name="type">
{foreach from=$type_list key=id item=name}
                        <option value="{$id|escape}"{if $type eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                    </select>
                    <div id="type_title_div">
                        <label>職稱:</label>
                        <select id="type_title" name="type_title">
{foreach from=$type_title_list key=id item=name}
                        <option value="{$id|escape}"{if $type_title eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                        </select>
                    </div>
                    <div id="type_detail_div">
                        <label>身份別:</label>
                        <select id="type_detail" name="type_detail">
{foreach from=$type_detail_list key=id item=name}
                        <option value="{$id|escape}"{if $type_detail eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                        </select>
                    </div>
                    <div id="type_location_div">
                    <label>縣市別</label>
                    <select id="type_location" name="type_location">
                        <option value="-1">任意</option>
{foreach from=$location_list key=id item=name}
                        <option value="{$id|escape}"{if $type_location eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                    </select>
                    </div>
                    <div id="type_doc_div">
                        <label>鄰近DOC:</label>
                        <select id="type_doc" name="type_doc">
                            <option value="-1">任意</option>
                        </select>
                    </div>
                </div>
            </p>
            <p>
                <label>排序:</label>
                <select name="sort">
{foreach from=$sort_list key=id item=name}
                    <option value="{$id|escape}"{if $sort eq $id} selected="selected"{/if}>{$name|escape}</option>
{/foreach}
                </select>
            </p>
        </div>
        </div>
        <input type="submit" value="送出" />
    </form>

{if $has_data}
    <table class="datatable">
        <tr>
{foreach from=$title item=text}
            <th><img src="{$tpl_path}/images/th_head.png" alt="" width="12" height="54" align="absmiddle"/>{$text|escape}</th>
{/foreach}
        </tr>
{foreach from=$data item=row}
        <tr>
{foreach from=$row item=text}
            <td>{$text|escape}</td>
{/foreach}
        </tr>
{/foreach}
    </table>
{/if}

</body>
</html>
